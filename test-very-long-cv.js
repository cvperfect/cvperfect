// Test with VERY LONG CV to find the breaking point
const testVeryLongCV = async () => {
  // Generate a very comprehensive CV (like senior developer with 10+ years experience)
  const veryLongCV = `KONRAD JAK√ìBCZAK
Senior Full-Stack Developer & Technical Lead | 10+ Years Experience

DANE KONTAKTOWE:
üìû +48 123 456 789
üìß konrad.jakobczak@example.com
üåê linkedin.com/in/konradjakobczak
üíª github.com/konradjakobczak
üè† Warszawa, Polska

PODSUMOWANIE ZAWODOWE:
Do≈õwiadczony Senior Full-Stack Developer z ponad 10-letnim do≈õwiadczeniem w tworzeniu enterprise aplikacji webowych. Technical Lead z umiejƒôtno≈õciami zarzƒÖdzania zespo≈Çami 15+ deweloper√≥w. Architekt rozwiƒÖza≈Ñ chmurowych AWS/Azure. Specjalista React, Node.js, i mikrous≈Çug. Certyfikowany AWS Solutions Architect i Scrum Master. Pasjonat DevOps, clean architecture i najnowszych technologii.

DO≈öWIADCZENIE ZAWODOWE:

Senior Technical Lead & Full-Stack Architect | TechCorp Enterprise | 2020-2024
‚Ä¢ ZarzƒÖdzanie zespo≈Çem 15 deweloper√≥w w 3 cross-functional teams
‚Ä¢ Architektowanie mikrous≈Çug obs≈ÇugujƒÖcych 1M+ u≈ºytkownik√≥w dziennie
‚Ä¢ Migracja monolitycznej aplikacji do cloud-native architecture (AWS)
‚Ä¢ Implementacja CI/CD pipeline redukujƒÖcego czas deploymentu o 85%
‚Ä¢ Optymalizacja performance - redukcja response time o 60%
‚Ä¢ Mentoring 25+ junior/mid developers na ≈õcie≈ºce kariery
‚Ä¢ Code review i zapewnianie jako≈õci kodu w projektach o warto≈õci $5M+
‚Ä¢ Wsp√≥≈Çpraca z C-level executives przy definiowaniu tech roadmap
‚Ä¢ Wdra≈ºanie Agile/Scrum methodology w organizacji 200+ os√≥b
‚Ä¢ Design i implementacja real-time analytics dashboard (React + WebSocket)
‚Ä¢ Bezpiecze≈Ñstwo aplikacji - implementacja OAuth 2.0, JWT, OWASP compliance
‚Ä¢ Performance monitoring - NewRelic, DataDog, custom metrics

Senior Full-Stack Developer | FinTech Solutions | 2018-2020
‚Ä¢ Rozw√≥j platformy p≈Çatniczej obs≈ÇugujƒÖcej 500K transakcji dziennie
‚Ä¢ Implementacja PCI DSS compliance dla systemu p≈Çatno≈õci
‚Ä¢ Real-time fraud detection system (Python + ML algorithms)
‚Ä¢ API Gateway design i implementacja (Kong, AWS API Gateway)
‚Ä¢ Database optimization - sharding PostgreSQL dla 100M+ rekord√≥w
‚Ä¢ React aplikacje z Redux, TypeScript, i Material-UI
‚Ä¢ Node.js microservices z Express, NestJS, i GraphQL
‚Ä¢ Event-driven architecture z Apache Kafka
‚Ä¢ Container orchestration z Kubernetes na AWS EKS
‚Ä¢ Monitoring i alerting - Prometheus, Grafana, ELK stack

Frontend Architect | StartupXYZ | 2016-2018
‚Ä¢ Architektowanie SPA aplikacji dla 50K+ daily active users
‚Ä¢ Migracja legacy jQuery aplikacji do React ecosystem
‚Ä¢ Webpack configuration i build optimization - 70% faster builds
‚Ä¢ Progressive Web App implementation z service workers
‚Ä¢ A/B testing framework implementacja i analytics
‚Ä¢ SEO optimization dla SPA - Server-Side Rendering z Next.js
‚Ä¢ Accessibility compliance WCAG 2.1 AAA level
‚Ä¢ Cross-browser compatibility testing i polyfills
‚Ä¢ Mobile-first responsive design z CSS Grid i Flexbox
‚Ä¢ Component library development z Storybook i automated testing

Full-Stack Developer | WebAgency Pro | 2014-2016
‚Ä¢ Full-stack rozw√≥j aplikacji dla klient√≥w enterprise
‚Ä¢ Custom CMS development z PHP (Laravel) i React
‚Ä¢ E-commerce platform integration - Magento, WooCommerce customization
‚Ä¢ Database design i optimization - MySQL, Redis caching
‚Ä¢ Third-party API integrations - payment gateways, CRM systems
‚Ä¢ DevOps automation - automated deployments, server management
‚Ä¢ Client communication i project management (Agile)

Junior Web Developer | Digital Solutions | 2012-2014
‚Ä¢ Frontend development - HTML5, CSS3, JavaScript (ES5)
‚Ä¢ WordPress theme development i customization
‚Ä¢ Basic PHP development i MySQL database management
‚Ä¢ Cross-browser testing i responsive design
‚Ä¢ SEO optimization i Google Analytics implementation
‚Ä¢ Client support i website maintenance

WYKSZTA≈ÅCENIE:

Magister Informatyki | Politechnika Warszawska | 2016-2018
Specjalizacja: Systemy Rozproszone i Architektury Chmurowe
Praca dyplomowa: "Optimization of Microservices Communication in Cloud Environment"
≈örednia ocen: 4.9/5.0
Wyr√≥≈ºnienie za najlepszƒÖ pracƒô dyplomowƒÖ roku

Licencjat Informatyki | Politechnika Warszawska | 2010-2014
Specjalizacja: In≈ºynieria Oprogramowania
Praca licencjacka: "Real-time Web Applications with WebSocket Technology"
≈örednia ocen: 4.7/5.0
Stypendium rektora za wyniki w nauce (3 lata)

UMIEJƒòTNO≈öCI TECHNICZNE:

Frontend Technologies (Expert Level):
‚Ä¢ JavaScript (ES6+), TypeScript - 10+ years, expert level
‚Ä¢ React, Redux, Redux Toolkit, React Query - 8+ years, expert
‚Ä¢ Vue.js, Vuex, Pinia - 5+ years, advanced
‚Ä¢ Angular 2+ - 3+ years, intermediate
‚Ä¢ HTML5, CSS3, SASS/SCSS, PostCSS - 10+ years, expert
‚Ä¢ Webpack, Vite, Rollup, Parcel - 6+ years, advanced
‚Ä¢ Next.js, Nuxt.js, Gatsby - 4+ years, advanced
‚Ä¢ Progressive Web Apps, Service Workers - 3+ years
‚Ä¢ Micro-frontends architecture - 2+ years

Backend Technologies (Expert Level):
‚Ä¢ Node.js, Express.js, NestJS - 8+ years, expert
‚Ä¢ Python, Django, FastAPI - 5+ years, advanced
‚Ä¢ PHP, Laravel, Symfony - 6+ years, advanced
‚Ä¢ Java, Spring Boot - 3+ years, intermediate
‚Ä¢ Go - 2+ years, basic-intermediate
‚Ä¢ GraphQL, REST API design - 6+ years, expert
‚Ä¢ WebSocket, Socket.io - 5+ years, advanced

Databases & Caching:
‚Ä¢ PostgreSQL, MySQL - 8+ years, expert level
‚Ä¢ MongoDB, DynamoDB - 5+ years, advanced
‚Ä¢ Redis, Memcached - 4+ years, advanced
‚Ä¢ Elasticsearch - 3+ years, intermediate
‚Ä¢ Database design, indexing, query optimization
‚Ä¢ Data modeling for both SQL and NoSQL

Cloud & DevOps (Advanced Level):
‚Ä¢ AWS (EC2, S3, Lambda, RDS, EKS, CloudFront) - 5+ years, advanced
‚Ä¢ Azure (App Service, Functions, CosmosDB) - 2+ years, intermediate
‚Ä¢ Docker, Docker Compose - 6+ years, expert
‚Ä¢ Kubernetes, Helm - 3+ years, advanced
‚Ä¢ CI/CD (GitHub Actions, GitLab CI, Jenkins) - 5+ years, expert
‚Ä¢ Infrastructure as Code (Terraform, CloudFormation) - 3+ years
‚Ä¢ Monitoring (DataDog, NewRelic, Prometheus) - 4+ years

Testing & Quality Assurance:
‚Ä¢ Jest, React Testing Library, Vitest - 6+ years, expert
‚Ä¢ Cypress, Playwright, Selenium - 4+ years, advanced
‚Ä¢ Unit testing, Integration testing, E2E testing
‚Ä¢ Test-Driven Development (TDD) - 5+ years
‚Ä¢ Storybook for component testing - 3+ years
‚Ä¢ Load testing (Artillery, k6) - 2+ years

CERTYFIKATY I KURSY:

‚Ä¢ AWS Certified Solutions Architect - Professional (2023)
‚Ä¢ AWS Certified Developer Associate (2022)
‚Ä¢ Certified Kubernetes Administrator (CKA) (2023)
‚Ä¢ Google Cloud Professional Cloud Architect (2022)
‚Ä¢ Certified Scrum Master (CSM) (2021)
‚Ä¢ React Professional Certificate - Meta (2020)
‚Ä¢ Node.js Certified Developer (2020)
‚Ä¢ Docker Certified Associate (2019)
‚Ä¢ MongoDB Certified Developer (2019)
‚Ä¢ Advanced JavaScript & TypeScript - Multiple Udemy courses (2018-2023)

JƒòZYKI:
‚Ä¢ Polski - jƒôzyk ojczysty (native)
‚Ä¢ Angielski - C2 (Cambridge Certificate of Proficiency)
‚Ä¢ Niemiecki - B2 (Goethe Certificate)
‚Ä¢ Hiszpa≈Ñski - A2 (basic conversational)

KLUCZOWE PROJEKTY:

1. Banking Platform Redesign (2023-2024)
Rola: Technical Lead & Senior Architect
Stack: React, TypeScript, Node.js, PostgreSQL, AWS, Kubernetes
Budget: $3M, Team: 12 developers
‚Ä¢ Complete redesign of online banking platform for 2M+ customers
‚Ä¢ Microservices architecture with 15+ services
‚Ä¢ Real-time transaction processing with 99.99% uptime SLA
‚Ä¢ PCI DSS Level 1 compliance implementation
‚Ä¢ Mobile-first responsive design with PWA capabilities
‚Ä¢ Integration with 50+ external financial APIs
‚Ä¢ Performance: < 200ms average response time
‚Ä¢ Security: Multi-factor authentication, biometric login
‚Ä¢ Result: 40% increase in customer satisfaction, 25% more digital transactions

2. E-commerce Marketplace Platform (2022-2023)
Rola: Full-Stack Architect & Team Lead  
Stack: Next.js, TypeScript, GraphQL, PostgreSQL, Redis, AWS
Budget: $2.5M, Team: 10 developers
‚Ä¢ Multi-vendor marketplace handling 100K+ products
‚Ä¢ Real-time inventory management across 500+ vendors
‚Ä¢ Advanced search with Elasticsearch and ML recommendations
‚Ä¢ Payment processing with multiple gateways (Stripe, PayPal, local)
‚Ä¢ Order management system with real-time tracking
‚Ä¢ Admin dashboard with comprehensive analytics
‚Ä¢ Mobile apps (React Native) with 500K+ downloads
‚Ä¢ SEO optimization resulting in 300% organic traffic increase
‚Ä¢ Result: $50M+ in annual transaction volume

3. Healthcare Management System (2021-2022)
Rola: Senior Full-Stack Developer & Security Lead
Stack: React, Node.js, PostgreSQL, AWS, HIPAA compliance
Budget: $1.8M, Team: 8 developers
‚Ä¢ Electronic Health Records (EHR) system for 200+ clinics
‚Ä¢ HIPAA compliance implementation and auditing
‚Ä¢ Telemedicine platform with video consultations
‚Ä¢ Appointment scheduling with automated reminders
‚Ä¢ Prescription management with e-prescribing
‚Ä¢ Integration with laboratory systems and insurance providers
‚Ä¢ Mobile app for patients with biometric authentication
‚Ä¢ Data encryption at rest and in transit
‚Ä¢ Result: 60% reduction in administrative workload, 95% patient satisfaction

4. Real-time Analytics Dashboard (2020-2021)
Rola: Frontend Architect & Performance Specialist
Stack: React, D3.js, WebSocket, InfluxDB, Kafka
Budget: $800K, Team: 6 developers
‚Ä¢ Real-time monitoring dashboard for IoT devices (10K+ sensors)
‚Ä¢ Data visualization with custom D3.js charts and graphs
‚Ä¢ WebSocket connections handling 1M+ events per minute
‚Ä¢ Anomaly detection with machine learning algorithms
‚Ä¢ Automated alerting system with SMS/email notifications
‚Ä¢ Historical data analysis with time-series database
‚Ä¢ Performance optimization for real-time data streams
‚Ä¢ Mobile-responsive design for field technicians
‚Ä¢ Result: 50% faster incident response time, $2M in operational savings

5. Content Management Platform (2019-2020)
Rola: Full-Stack Developer & API Designer
Stack: Vue.js, Laravel, MySQL, Redis, AWS S3
Budget: $600K, Team: 5 developers
‚Ä¢ Headless CMS for media companies with 50+ editors
‚Ä¢ Multi-tenant architecture supporting 100+ websites
‚Ä¢ Advanced media management with image/video processing
‚Ä¢ Workflow management with approval chains
‚Ä¢ SEO optimization tools and automated meta tag generation
‚Ä¢ CDN integration with automatic image optimization
‚Ä¢ API-first design with comprehensive documentation
‚Ä¢ Multi-language support for global content distribution
‚Ä¢ Result: 70% faster content publishing, 40% SEO improvement

DODATKOWE UMIEJƒòTNO≈öCI I OSIƒÑGNIƒòCIA:

Technical Leadership:
‚Ä¢ ZarzƒÖdzanie zespo≈Çami do 15 os√≥b (direct reports)
‚Ä¢ Mentoring programy dla 50+ junior/mid developers
‚Ä¢ Technical interviews i rekrutacja (100+ kandydat√≥w)
‚Ä¢ Architecture decision records (ADR) i technical documentation
‚Ä¢ Cross-team collaboration i stakeholder communication
‚Ä¢ Agile/Scrum/Kanban methodology implementation
‚Ä¢ Code review culture i quality gates implementation

Open Source Contributions:
‚Ä¢ Maintainer popularnego React UI library (5K+ GitHub stars)
‚Ä¢ Contributor do React, Vue.js, i Node.js ecosystem
‚Ä¢ 500+ GitHub contributions w ostatnim roku
‚Ä¢ Speaker na konferencjach: React Summit, Node.js Conference
‚Ä¢ Tech blog na Medium z 50K+ monthly readers
‚Ä¢ Podcast guest: "Software Engineering Daily", "React Podcast"

Business Impact:
‚Ä¢ Led technology initiatives generating $10M+ in revenue
‚Ä¢ Cost optimization projects saving $500K+ annually
‚Ä¢ Process improvements reducing development time by 40%
‚Ä¢ Security audits preventing potential $2M+ in losses
‚Ä¢ Performance optimizations improving user experience for 1M+ users

ZAINTERESOWANIA I AKTYWNO≈öCI:

Professional Development:
‚Ä¢ Regular conference attendance (20+ events w ostatnich 3 latach)
‚Ä¢ Continuous learning - 100+ hours of online courses yearly
‚Ä¢ Technology podcasts i technical literature
‚Ä¢ Open source contributing (weekend hobby)
‚Ä¢ Technical blogging i knowledge sharing

Personal Interests:
‚Ä¢ Marathon runner - 5 completed marathons (Warsaw, Berlin, NYC)
‚Ä¢ Photography - landscape i street photography (Instagram: 10K followers)
‚Ä¢ Travel - visited 30+ countries, digital nomad experience
‚Ä¢ Cooking - specialty in Asian cuisine
‚Ä¢ Chess - tournament player (rating 2000+)
‚Ä¢ Mountain hiking - Tatra Mountains regular

Community Involvement:
‚Ä¢ Volunteer programming instructor for kids (2+ years)
‚Ä¢ Mentor w startup accelerator programs
‚Ä¢ Judge w hackathon competitions (10+ events)
‚Ä¢ Technical advisor dla 3 startups
‚Ä¢ University guest lecturer (Politechnika Warszawska)

NAGRODY I WYR√ì≈ªNIENIA:

‚Ä¢ "Developer of the Year" - TechCorp (2023)
‚Ä¢ "Innovation Award" za best architecture design (2022)
‚Ä¢ "Top Performer" recognition 3 years running (2021-2023)
‚Ä¢ "Community Leader" award - local React meetup (2021)
‚Ä¢ "Best Graduation Thesis" - Politechnika Warszawska (2018)
‚Ä¢ Hackathon winner - FinTech Challenge Warsaw (2019)
‚Ä¢ Speaker excellence award - React Warsaw Conference (2020)

PUBLIKACJE I WYSTƒÑPIENIA:

Articles & Blog Posts:
‚Ä¢ "Microservices Architecture Patterns" - Medium (50K+ views)
‚Ä¢ "React Performance Optimization Guide" - Dev.to (30K+ views)
‚Ä¢ "Modern CI/CD for Frontend Applications" - CSS-Tricks (20K+ views)
‚Ä¢ "Security Best Practices for Node.js" - LogRocket (25K+ views)
‚Ä¢ "Building Scalable Real-time Applications" - Smashing Magazine

Conference Talks:
‚Ä¢ "The Future of Frontend Architecture" - React Summit 2023
‚Ä¢ "Performance at Scale" - Frontend Conference 2022
‚Ä¢ "Microservices Communication Patterns" - Node.js Conference 2021
‚Ä¢ "Modern DevOps for Frontend Teams" - DevOps Days Warsaw 2020

REFERENCJE:

‚Ä¢ John Smith, CTO at TechCorp - john.smith@techcorp.com
‚Ä¢ Maria Rodriguez, VP Engineering at FinTech Solutions - maria@fintech.com  
‚Ä¢ David Chen, Product Director at StartupXYZ - david@startupxyz.com
‚Ä¢ Sarah Johnson, CEO at WebAgency Pro - sarah@webagency.com

Portfolio i szczeg√≥≈Çowe referencje dostƒôpne na ≈ºyczenie.
LinkedIn: linkedin.com/in/konradjakobczak
GitHub: github.com/konradjakobczak
Portfolio: konradjakobczak.dev`;

  try {
    console.log(`üìù Testing with VERY LONG CV: ${veryLongCV.length} characters`);
    console.log(`üìä Expected token count: ~${Math.round(veryLongCV.length / 4)} tokens`);
    
    const response = await fetch('http://localhost:3000/api/analyze', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        currentCV: veryLongCV,
        email: 'test@premium.com',
        paid: true,
        jobPosting: 'Senior Technical Lead - We are looking for an experienced technical leader with 10+ years of experience in full-stack development, team management, AWS cloud architecture, and enterprise application development.'
      })
    });

    const data = await response.json();
    
    console.log('\nüìä VERY LONG CV TEST RESULTS:');
    console.log('===============================');
    console.log(`‚úÖ Success: ${data.success}`);
    console.log(`üìù Original CV: ${veryLongCV.length} characters`);
    console.log(`ü§ñ Optimized CV: ${data.optimizedCV?.length || 0} characters`);
    console.log(`üìà Length ratio: ${data.optimizedCV ? (data.optimizedCV.length / veryLongCV.length * 100).toFixed(1) : 0}%`);
    
    // Check if critical end sections are present
    const endSections = [
      'REFERENCJE',
      'Portfolio',
      'GitHub',
      'PUBLIKACJE',
      'NAGRODY',
      'WYSTƒÑPIENIA'
    ];
    
    console.log('\nüîç END SECTIONS CHECK:');
    endSections.forEach(section => {
      const found = data.optimizedCV?.includes(section) || 
                   data.optimizedCV?.toLowerCase().includes(section.toLowerCase());
      console.log(`${found ? '‚úÖ' : '‚ùå'} ${section}`);
    });
    
    // Check the actual ending
    const lastChars = data.optimizedCV?.slice(-200) || '';
    console.log('\nüèÅ ACTUAL ENDING:');
    console.log(`"${lastChars}"`);
    
    // Determine if truncated
    const seemsTruncated = !lastChars.includes('</') && 
                          !lastChars.includes('Portfolio') && 
                          !lastChars.includes('konradjakobczak') &&
                          data.optimizedCV?.length < veryLongCV.length * 0.6;
    
    console.log(`\n${seemsTruncated ? 'üî¥ TRUNCATION DETECTED' : '‚úÖ APPEARS COMPLETE'}`);
    
    if (data.error) {
      console.log(`‚ùå ERROR: ${data.error}`);
    }
    
  } catch (error) {
    console.error('‚ùå Test failed:', error.message);
  }
};

testVeryLongCV();